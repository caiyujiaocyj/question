flow_segments = []
    for cylinder in cylinders:
        start = cylinder['start']
        end = cylinder['end']
        radius = cylinder['radius']
        # unified_id = cylinder['unified_id']
        
        if np.linalg.norm(np.subtract(end, start)) == 0:
            continue

        if 'unified_id' not in cylinder:
            print(f"Warning: Missing unified_id in {cylinder}")
            continue
        # 获取并处理 unified_id
        unified_id = cylinder['unified_id']

        unified_id = set(unified_id)

        if isinstance(unified_id, list):
            unified_id = "_".join(map(str, unified_id))  # 列表转字符串
        
        # 生成名称
        original_name = cylinder.get('name', "FlowSegment")
        new_name = f"{original_name}_{unified_id}"
        print(f"Generated name: {new_name}")  # 调试输出

        # 创建IFC的流动段（IfcFlowSegment）
        flow_segment = ifc_file.create_entity(
            'IfcFlowSegment',
            GlobalId=ifcopenshell.guid.new(),
            OwnerHistory=owner_history,
            Name=new_name,
            ObjectPlacement=ifc_file.createIfcLocalPlacement(storey_placement, axis_placement)
        )

        # 创建圆柱的几何表示
        cylinder_geometry = create_cylinder_geometry(ifc_file, start, end, radius, context)

        # 将几何体添加到流动段中
        flow_segment.Representation = ifc_file.create_entity(
            'IfcProductDefinitionShape',
            Representations=[cylinder_geometry]
        )

        pset = ifcopenshell.api.run(
            "pset.add_pset",
            ifc_file,
            product=flow_segment,
            name="Property"
        )
        length = get_length(cylinder)
        confidence = cylinder.get('confidence', cylinder.get('coverage', 1.))
        properties = {
            'length': (f"{length:.3f}", "IfcLengthMeasure"),
            'StartPoint': (f"({start[0]:.3f}, {start[1]:.3f}, {start[2]:.3f})", "IfcLabel"),
            'EndPoint': (f"({end[0]:.3f}, {end[1]:.3f}, {end[2]:.3f})", "IfcLabel"),
            'Radius': (f"{radius:.3f}", "IfcLengthMeasure"),
            'Diameter': (f"{radius * 2:.3f}", "IfcLengthMeasure"),
            'Confidence': (f"{confidence:.3f}", "IfcNormalisedRatioMeasure"),
        }

        ifcopenshell.api.pset.edit_pset(
            ifc_file,
            pset,
            properties={k: v[0] for k, v in properties.items()}
        )

        flow_segments.append(flow_segment)
